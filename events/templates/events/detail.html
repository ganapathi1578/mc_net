{% extends "accounts/base.html" %}
{% load humanize %}
{% block title %}{{ event.title }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-10">
    <div class="card mb-4 shadow-sm">
      {% if event.image %}
        <img src="{{ event.image.url }}" class="card-img-top" style="height:420px; object-fit:cover;">
      {% else %}
        <div class="bg-light d-flex align-items-center justify-content-center" style="height:240px;">
          <div class="text-center text-muted">
            <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" fill="currentColor" class="bi bi-calendar-event" viewBox="0 0 16 16">
              <path d="M11 6.5a.5.5 0 0 1 .5-.5h1.5v1H11.5a.5.5 0 0 1-.5-.5z"/>
              <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8v-.5a.5.5 0 0 1 1 0V1h.5A1.5 1.5 0 0 1 15 2.5v10A1.5 1.5 0 0 1 13.5 14H2.5A1.5 1.5 0 0 1 1 12.5v-10A1.5 1.5 0 0 1 2.5 1H3v-.5A.5.5 0 0 1 3.5 0zM2 4v8.5c0 .276.224.5.5.5h11c.276 0 .5-.224.5-.5V4H2z"/>
            </svg>
            <div class="mt-2">No image</div>
          </div>
        </div>
      {% endif %}

      <div class="card-body">
        <div class="d-flex align-items-start mb-3">
          <!-- Author avatar -->
          <div class="me-3">
            {% if event.author.profile.avatar %}
              <img src="{{ event.author.profile.avatar.url }}" alt="avatar" class="rounded-circle border" style="width:64px; height:64px; object-fit:cover;">
            {% else %}
              <div class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center" style="width:64px; height:64px; font-weight:600;">
                {{ event.author.name|default:event.author.email|slice:":1"|upper }}
              </div>
            {% endif %}
          </div>

          <!-- Title + meta -->
          <div class="flex-grow-1">
            <h2 class="mb-1">{{ event.title }}</h2>
            <p class="mb-1 text-muted">
              By <strong>{{ event.author.name }}</strong>
              &middot;
              {{ event.created_at|date:"F j, Y, g:i A" }}
              &middot;
              <small class="text-muted">{{ event.created_at|naturaltime }}</small>
            </p>
            {% if event.is_published %}
              <span class="badge bg-success">Published</span>
            {% else %}
              <span class="badge bg-secondary">Draft</span>
            {% endif %}
          </div>

          <!-- Actions -->
          <div class="ms-3 text-end">
            {% if request.user.is_authenticated and request.user == event.author or request.user.is_staff %}
              <a class="btn btn-sm btn-outline-primary mb-2" href="{% url 'events:edit' event.pk %}">Edit</a>
              <!-- delete triggers modal -->
              <button class="btn btn-sm btn-outline-danger mb-2" data-bs-toggle="modal" data-bs-target="#deleteModal">Delete</button>
            {% endif %}
            <a class="btn btn-sm btn-outline-secondary mb-2" href="{% url 'events:list' %}">Back</a>
          </div>
        </div>

        <!-- Body -->
        <div class="mb-3">
          {{ event.body|linebreaks }}
        </div>

        <!-- Optional small footer with author email / share -->
        <div class="d-flex justify-content-between align-items-center mt-4">
          <small class="text-muted">Posted by {{ event.author.email }}</small>
          <div>
            <!-- simple copy link button -->
            <button class="btn btn-sm btn-outline-secondary" id="copyLinkBtn" data-link="{{ request.build_absolute_uri }}">Copy link</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Delete confirmation modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <form method="post" action="{% url 'events:delete' event.pk %}">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title" id="deleteModalLabel">Delete event</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Are you sure you want to delete "<strong>{{ event.title }}</strong>"? This action cannot be undone.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-danger">Yes, delete</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- small JS: copy link -->
<script>
document.addEventListener("DOMContentLoaded", function() {
  const btn = document.getElementById("copyLinkBtn");
  if (!btn) return;
  btn.addEventListener("click", function() {
    const link = btn.dataset.link;
    navigator.clipboard?.writeText(link).then(() => {
      btn.innerText = "Copied!";
      setTimeout(() => btn.innerText = "Copy link", 1500);
    }).catch(() => {
      // fallback
      prompt("Copy this link:", link);
    });
  });
});
</script>
{% endblock %}
